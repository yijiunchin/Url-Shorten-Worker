/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /gh/Monopink/Url-Shorten-Worker@gh-pages/main.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
let res,
	passwordText = document.querySelector("#passwordText").value;
function shorturl() {
	"" != document.querySelector("#longURL").value
		? ((document.getElementById("addBtn").disabled = !0),
		  (document.getElementById("addBtn").innerHTML =
			  '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 縮址中……'),
		  fetch(window.location.pathname, {
			  method: "POST",
			  headers: { "Content-Type": "application/json" },
			  body: JSON.stringify({
				  cmd: "add",
				  url: document.querySelector("#longURL").value,
				  keyPhrase: document.querySelector("#keyPhrase").value,
				  password: passwordText,
			  }),
		  })
			  .then(function (e) {
				  return e.json();
			  })
			  .then(function (e) {
				  if (
					  ((res = e),
					  (document.getElementById("addBtn").disabled = !1),
					  (document.getElementById("addBtn").innerHTML =
						  "縮！"),
					  "200" == res.status)
				  ) {
					  let e = res.key,
						  t = document.querySelector("#longURL").value;
					  localStorage.setItem(e, t),
						  addUrlToList(e, t),
						  (document.getElementById("result").innerHTML =
							  window.location.origin + "/" + res.key);
				  } else document.getElementById("result").innerHTML = res.error;
				  $("#resultModal").modal("show");
			  })
			  .catch(function (e) {
				  alert("Unknow error. Please retry!"),
					  console.log(e),
					  (document.getElementById("addBtn").disabled = !1),
					  (document.getElementById("addBtn").innerHTML =
						  "縮！");
			  }))
		: alert("URL cannot be empty!");
}
function copyurl(e, t) {
	let n = null;
	if (t) {
		if (
			((n = document.createElement("div")),
			(n.id = "tempTarget"),
			(n.style.opacity = "0"),
			e)
		) {
			let o = document.querySelector("#" + e);
			n.innerText = o[t];
		} else n.innerText = t;
		document.body.appendChild(n);
	} else n = document.querySelector("#" + e);
	try {
		let e = document.createRange();
		e.selectNode(n),
			window.getSelection().removeAllRanges(),
			window.getSelection().addRange(e),
			document.execCommand("copy"),
			window.getSelection().removeAllRanges(),
			console.log("Copy success");
	} catch (e) {
		console.log("Copy error");
	}
	t && n.parentElement.removeChild(n);
}
function loadUrlList() {
	let e = document.querySelector("#urlList");
	for (; e.firstChild; ) e.removeChild(e.firstChild);
	let t = document.querySelector("#longURL").value,
		n = localStorage.length;
	for (; n > 0; n--) {
		let e = localStorage.key(n - 1),
			o = localStorage.getItem(e);
		("" != t && t != o) || addUrlToList(e, o);
	}
}
function reloadUrlList() {
	let e = document.querySelector("#urlList");
	for (; e.firstChild; ) e.removeChild(e.firstChild);
	let t = document.querySelector("#longURL").value,
		n = localStorage.length;
	for (; n > 0; n--) {
		let e = localStorage.key(n - 1),
			o = localStorage.getItem(e);
		("" != t && t != o) || addUrlToList(e, o);
	}
	alert("Record loaded.");
}
function addUrlToList(e, t) {
	document.getElementById("record").style.display = "block";
	let n = document.querySelector("#urlList"),
		o = document.createElement("div");
	o.classList.add("col");
	let l = document.createElement("span");
	(l.innerText = window.location.origin + "/" + e + " 🔗 " + t),
		o.appendChild(l);
	let d = document.createElement("div");
	d.classList.add("col-auto", "align-self-start");
	let r = document.createElement("button");
	r.setAttribute("type", "button"),
		r.classList.add("btn", "btn-outline-danger", "btn-sm"),
		r.setAttribute("onclick", 'deleteShortUrl("' + e + '")'),
		r.setAttribute("id", "delBtn-" + e),
		(r.innerText = "✘"),
		d.appendChild(r);
	let a = document.createElement("div");
	a.classList.add("row", "align-items-center"),
		a.appendChild(o),
		a.appendChild(d);
	let s = document.createElement("div");
	s.classList.add("list-group-item"), s.appendChild(a), n.append(s);
}
function clearLocalStorage() {
	localStorage.clear(), alert("Record deleted.");
}
function deleteShortUrl(e) {
	(document.getElementById("delBtn-" + e).disabled = !0),
		(document.getElementById("delBtn-" + e).innerHTML =
			'<span class="spinner-border spinner-border-sm" role="status"></span>'),
		fetch(window.location.pathname, {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({
				cmd: "del",
				keyPhrase: e,
				password: passwordText,
			}),
		})
			.then(function (e) {
				return e.json();
			})
			.then(function (t) {
				(res = t),
					"200" == res.status
						? (localStorage.removeItem(e),
						  loadUrlList(),
						  (document.getElementById("result").innerHTML =
							  "已刪除"))
						: ((document.getElementById("delBtn-").disabled = !1),
						  (document.getElementById("delBtn-").innerHTML = "✘"),
						  (document.getElementById("result").innerHTML =
							  res.error)),
					$("#resultModal").modal("show");
			})
			.catch(function (e) {
				(document.getElementById("delBtn-").disabled = !1),
					(document.getElementById("delBtn-").innerHTML = "✘"),
					alert("Unknow error. Please retry!"),
					console.log(e);
			});
}
function loadKV() {
	(document.getElementById("loadKV2localStgBtn").disabled = !0),
		(document.getElementById("loadKV2localStgBtn").innerHTML =
			'<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 下載中……'),
		fetch(window.location.pathname, {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify({ cmd: "qryall", password: passwordText }),
		})
			.then(function (e) {
				return e.json();
			})
			.then(function (e) {
				((res = e), "200" == res.status)
					? (localStorage.clear(),
					  res.kvlist.forEach((e) => {
						  (keyPhrase = e.key),
							  (valueLongURL = e.value),
							  localStorage.setItem(keyPhrase, valueLongURL);
					  }),
					  alert("Record downloaded."),
					  location.reload())
					: ((document.getElementById("result").innerHTML =
						  res.error),
					  new bootstrap.Modal(
						  document.getElementById("resultModal")
					  ).show());
			})
			.catch(function (e) {
				alert("Unknow error. Please retry!"), console.log(e);
			})
			.finally(function () {
				(document.getElementById("loadKV2localStgBtn").disabled = !1),
					(document.getElementById("loadKV2localStgBtn").innerHTML =
						"下載紀錄");
			});
}
$(function () {
	$('[data-toggle="popover"]').popover();
}),
	(document.getElementById("basic-addon2").innerHTML =
		"https://" + window.location.host + "/"),
	loadUrlList();
//# sourceMappingURL=/sm/2c3edafe0144d7c2cb7cc4e4e6aa919a72e023bf7a2bf7142372a217ce62429c.map
