/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /gh/Monopink/Url-Shorten-Worker@gh-pages/main.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
let res,
  passwordText = document.querySelector("#passwordText").value;
function shorturl() {
  "" != document.querySelector("#longURL").value
    ? ((document.getElementById("addBtn").disabled = !0),
      (document.getElementById("addBtn").innerHTML =
        '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> ç¸®å€ä¸­â€¦â€¦'),
      fetch(window.location.pathname, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          cmd: "add",
          url: document.querySelector("#longURL").value,
          keyPhrase: document.querySelector("#keyPhrase").value,
          password: passwordText,
        }),
      })
        .then(function (e) {
          return e.json();
        })
        .then(function (e) {
          if (
            ((res = e),
              (document.getElementById("addBtn").disabled = !1),
              (document.getElementById("addBtn").innerHTML = "ç¸®ï¼"),
              "200" == res.status)
          ) {
            let e = res.key,
              t = document.querySelector("#longURL").value;
            localStorage.setItem(e, t),
              addUrlToList(e, t),
              (document.getElementById("result").innerHTML =
                window.location.origin + "/" + res.key);
            // æˆåŠŸå¾Œæ¸…ç©ºè¼¸å…¥æ¡†
            document.querySelector("#longURL").value = "";
          } else document.getElementById("result").innerHTML = res.error;
          $("#resultModal").modal("show");
        })
        .catch(function (e) {
          alert("Unknow error. Please retry!"),
            console.log(e),
            (document.getElementById("addBtn").disabled = !1),
            (document.getElementById("addBtn").innerHTML = "ç¸®ï¼");
        }))
    : alert("URL cannot be empty!");
}
function copyurl(e, t) {
  let n = null;
  if (t) {
    if (
      ((n = document.createElement("div")),
        (n.id = "tempTarget"),
        (n.style.opacity = "0"),
        e)
    ) {
      let o = document.querySelector("#" + e);
      n.innerText = o[t];
    } else n.innerText = t;
    document.body.appendChild(n);
  } else n = document.querySelector("#" + e);
  try {
    let e = document.createRange();
    e.selectNode(n),
      window.getSelection().removeAllRanges(),
      window.getSelection().addRange(e),
      document.execCommand("copy"),
      window.getSelection().removeAllRanges(),
      console.log("Copy success");
  } catch (e) {
    console.log("Copy error");
  }
  t && n.parentElement.removeChild(n);
}
function loadUrlList() {
  const e = document.querySelector("#urlList");
  // æ¸…ç©ºåˆ—è¡¨
  while (e.firstChild) e.removeChild(e.firstChild);
  // å–å‡ºæ‰€æœ‰ç´€éŒ„
  for (let i = localStorage.length - 1; i >= 0; i--) {
    const key = localStorage.key(i),
          val = localStorage.getItem(key);
    addUrlToList(key, val);
  }
}
function reloadUrlList() {
  const e = document.querySelector("#urlList");
  while (e.firstChild) e.removeChild(e.firstChild);
  for (let i = localStorage.length - 1; i >= 0; i--) {
    const key = localStorage.key(i),
          val = localStorage.getItem(key);
    addUrlToList(key, val);
  }
  alert("Record loaded.");
}
function addUrlToList(e, t) {
  document.getElementById("record").style.display = "block";
  let n = document.querySelector("#urlList"),
    o = document.createElement("div");
  o.classList.add("col");
  let l = document.createElement("span");

  // ä¾›è¤‡è£½å‡½å¼ä½¿ç”¨
  l.setAttribute("id", "short-" + e);

  // åœ¨ ğŸ”— å‰é¢æ’å…¥æ›è¡Œ
  l.innerHTML = window.location.origin + "/" + e + "<br>ğŸ”— " + t;
  o.appendChild(l);

  let d = document.createElement("div");
  d.classList.add("col-auto", "align-self-start");

  // åˆªé™¤æŒ‰éˆ•
  let r = document.createElement("button");
  r.setAttribute("type", "button"),
    r.classList.add("btn", "btn-outline-danger", "btn-sm"),
    r.setAttribute("onclick", 'deleteShortUrl("' + e + '")'),
    r.setAttribute("id", "delBtn-" + e),
    (r.innerText = "âœ˜"),
    d.appendChild(r);

  // è¤‡è£½çŸ­ç¶²å€æŒ‰éˆ•
  let c = document.createElement("button");
  c.setAttribute("type", "button");
  c.classList.add("btn", "btn-outline-secondary", "btn-sm", "ml-1");
  c.setAttribute("onclick", 'copyurl("short-' + e + '")');
  c.setAttribute("id", "copyBtn-" + e);
  c.innerText = "ğŸ“‹";
  d.appendChild(c);

  let a = document.createElement("div");
  a.classList.add("row", "align-items-center"),
    a.appendChild(o),
    a.appendChild(d);

  let s = document.createElement("div");
  s.classList.add("list-group-item"), s.appendChild(a), n.append(s);
}

function clearLocalStorage() {
  localStorage.clear(), alert("Record deleted.");
  reloadUrlList();
}

function deleteShortUrl(e) {
  (document.getElementById("delBtn-" + e).disabled = !0),
    (document.getElementById("delBtn-" + e).innerHTML =
      '<span class="spinner-border spinner-border-sm" role="status"></span>'),
    fetch(window.location.pathname, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        cmd: "del",
        keyPhrase: e,
        password: passwordText,
      }),
    })
      .then(function (e) {
        return e.json();
      })
      .then(function (t) {
        res = t;
        if (res.status == "200") {
          // æˆåŠŸåˆªé™¤ï¼šç§»é™¤ localStorage ä¸¦é‡è¼‰åˆ—è¡¨ï¼Œä¸é¡¯ç¤º Modal
          localStorage.removeItem(e);
          loadUrlList();
        } else {
          // åˆªé™¤å¤±æ•—ï¼šæ¢å¾©æŒ‰éˆ•ç‹€æ…‹ã€é¡¯ç¤ºéŒ¯èª¤ä¸¦å½ˆå‡º Modal
          document.getElementById("delBtn-" + e).disabled = false;
          document.getElementById("delBtn-" + e).innerHTML = "âœ˜";
          document.getElementById("result").innerHTML = res.error;
          $("#resultModal").modal("show");
        }
      })
      .catch(function (e) {
        (document.getElementById("delBtn-").disabled = !1),
          (document.getElementById("delBtn-").innerHTML = "âœ˜"),
          alert("Unknow error. Please retry!"),
          console.log(e);
      });
}
function loadKV() {
  (document.getElementById("loadKV2localStgBtn").disabled = !0),
    (document.getElementById("loadKV2localStgBtn").innerHTML =
      '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> ä¸‹è¼‰ä¸­â€¦â€¦'),
    fetch(window.location.pathname, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ cmd: "qryall", password: passwordText }),
    })
      .then(function (e) {
        return e.json();
      })
      .then(function (e) {
        ((res = e), "200" == res.status)
          ? (localStorage.clear(),
            res.kvlist.forEach((e) => {
              (keyPhrase = e.key),
                (valueLongURL = e.value),
                localStorage.setItem(keyPhrase, valueLongURL);
            }),
            alert("Record downloaded."),
            location.reload())
          : ((document.getElementById("result").innerHTML =
            res.error),
            new bootstrap.Modal(
              document.getElementById("resultModal")
            ).show());
      })
      .catch(function (e) {
        alert("Unknow error. Please retry!"), console.log(e);
      })
      .finally(function () {
        (document.getElementById("loadKV2localStgBtn").disabled = !1),
          (document.getElementById("loadKV2localStgBtn").innerHTML =
            "ä¸‹è¼‰ç´€éŒ„");
      });
}
$(function () {
  $('[data-toggle="popover"]').popover();
}),
  (document.getElementById("basic-addon2").innerHTML =
    "https://" + window.location.host + "/"),
  loadUrlList();
//# sourceMappingURL=/sm/2c3edafe0144d7c2cb7cc4e4e6aa919a72e023bf7a2bf7142372a217ce62429c.map
